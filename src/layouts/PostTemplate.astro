---
import Header from "@/components/Header.astro"
import Footer from "@/components/Footer.astro"
import Layout from "@/layouts/Layout.astro"
import type { Post } from "@/types/type.d.ts"
import TableOfContents from "@/components/TableOfContents.astro"
import { load } from "cheerio"

type Props = {
    post: Post
}

const { post } = Astro.props

let description = ""

if (post.metaDescription) {
    description = post.metaDescription
} else {
    const $ = load(post.old_content ?? post.content)
    description = $.root().text().slice(0, 100).replace(/\s+/g, " ") + "..."
}

const image = post.eyecatch?.url
---

<Layout title={post.title} description={description} image={image}>
    <Header currentPage={post.category.id}>
        <TableOfContents contents={post.old_content ?? post.content} slot="toc" />
    </Header>
    <main>
        <slot />
    </main>
    <Footer />
</Layout>
